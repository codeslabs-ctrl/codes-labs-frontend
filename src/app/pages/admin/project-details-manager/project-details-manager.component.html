<div class="min-h-screen bg-background p-6">
  <div class="max-w-5xl mx-auto">
    <!-- Botón de regreso -->
    <div class="mb-4">
      <app-button (click)="close()" [variant]="'outline'" size="sm">
        <lucide-icon name="arrow-left" class="mr-2 h-4 w-4"></lucide-icon>
        Regresar a la lista
      </app-button>
    </div>
    
    <app-card class="bg-card border-border">
      <app-card-header>
        <app-card-title>
          <lucide-icon name="file-text" class="mr-2 h-6 w-6 text-cyan-500 inline"></lucide-icon>
          Gestionar Detalles: {{ projectTitle }}
        </app-card-title>
      </app-card-header>
      <app-card-content>
        @if (isLoading) {
          <div class="flex justify-center items-center py-12">
            <lucide-icon name="loader-2" class="h-8 w-8 text-cyan-500 animate-spin"></lucide-icon>
          </div>
        } @else {
          <!-- Formulario de detalle -->
          <div class="mb-6 p-4 bg-muted/50 rounded-lg border border-border">
            <h3 class="text-lg font-semibold text-foreground mb-4">
              {{ editingDetailId ? 'Editar Detalle' : 'Nuevo Detalle' }}
            </h3>
            <form [formGroup]="detailForm" (ngSubmit)="saveDetail()" class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-foreground mb-2">Contenido del Detalle *</label>
                <textarea
                  formControlName="projectDetail"
                  rows="6"
                  class="w-full px-4 py-2 border border-border rounded-lg bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-cyan-500 font-mono text-sm"
                  placeholder="Puedes usar Markdown: ## Título, **negrita**, - lista..."
                  [class.border-red-500]="detailForm.get('projectDetail')?.invalid && detailForm.get('projectDetail')?.touched"
                ></textarea>
                @if (detailForm.get('projectDetail')?.invalid && detailForm.get('projectDetail')?.touched) {
                  <p class="text-red-500 text-sm mt-1">El contenido es requerido</p>
                }
              </div>
              <div class="grid md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-foreground mb-2">Orden de Visualización</label>
                  <input
                    type="number"
                    formControlName="displayOrder"
                    min="0"
                    class="w-full px-4 py-2 border border-border rounded-lg bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-cyan-500"
                  />
                </div>
                <div class="flex items-center gap-2 mt-8">
                  <input
                    type="checkbox"
                    formControlName="isActive"
                    id="detailIsActive"
                    class="w-4 h-4"
                  />
                  <label for="detailIsActive" class="text-sm font-medium text-foreground">Detalle Activo</label>
                </div>
              </div>
              <div class="flex gap-2">
                <app-button type="submit" [variant]="'default'">
                  <lucide-icon name="save" class="mr-2 h-4 w-4"></lucide-icon>
                  {{ editingDetailId ? 'Actualizar' : 'Crear' }}
                </app-button>
                @if (editingDetailId) {
                  <app-button type="button" (click)="createDetail()" [variant]="'outline'">
                    Cancelar Edición
                  </app-button>
                }
              </div>
            </form>
          </div>

          <!-- Lista de detalles -->
          <div>
            <h3 class="text-lg font-semibold text-foreground mb-4">Detalles Existentes ({{ currentProjectDetails.length }})</h3>
            @if (currentProjectDetails.length === 0) {
              <div class="text-center py-8 text-muted-foreground">
                <lucide-icon name="file-text" class="h-12 w-12 mx-auto mb-2 opacity-50"></lucide-icon>
                <p>No hay detalles registrados. Crea el primero arriba.</p>
              </div>
            } @else {
              <div class="space-y-4">
                @for (detail of currentProjectDetails; track detail.id) {
                  <app-card class="bg-muted/30 border-border">
                    <app-card-content class="p-4">
                      <div class="flex items-start justify-between gap-4">
                        <div class="flex-1">
                          <div class="flex items-center gap-2 mb-2">
                            <span class="text-xs font-medium text-muted-foreground bg-background px-2 py-1 rounded">
                              Orden: {{ detail.displayOrder }}
                            </span>
                            @if (!detail.isActive) {
                              <app-badge [variant]="'outline'" class="text-red-500 text-xs">Inactivo</app-badge>
                            }
                          </div>
                          <div class="prose prose-sm dark:prose-invert max-w-none">
                            <pre class="whitespace-pre-wrap text-sm text-foreground bg-background p-3 rounded border border-border">{{ detail.projectDetail }}</pre>
                          </div>
                        </div>
                        <div class="flex flex-col gap-2">
                          <app-button (click)="editDetail(detail)" size="sm" [variant]="'outline'">
                            <lucide-icon name="edit" class="h-4 w-4"></lucide-icon>
                          </app-button>
                          <app-button (click)="deleteDetail(detail)" size="sm" [variant]="'outline'" class="text-red-500">
                            <lucide-icon name="trash-2" class="h-4 w-4"></lucide-icon>
                          </app-button>
                        </div>
                      </div>
                    </app-card-content>
                  </app-card>
                }
              </div>
            }
          </div>
        }
      </app-card-content>
    </app-card>
  </div>
</div>

